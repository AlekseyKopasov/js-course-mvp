# Контекст this

## Основные принципы работы **this**

`this` — это ключевое слово, которое ссылается на объект, в контексте которого выполняется функция. Поведение `this` в JavaScript отличается от других языков программирования.

### Особенности:
- Значение определяется в момент вызова функции
- Зависит от способа вызова функции
- В strict mode без контекста будет `undefined` (вместо `window`)

## Основные сценарии поведения

### 1. Метод объекта

```javascript
const user = {
  name: 'Анна',
  greet() {
    console.log(`Привет, ${this.name}!`);
  }
};

user.greet(); // "Привет, Анна!"
```

### 2. Обычный вызов функции

```javascript
function showThis() {
  console.log(this);
}

showThis(); // В нестрогом режиме: window/global
            // В strict mode: undefined
```

### 3. Обработчики событий

```javascript
const button = document.querySelector('button');
button.addEventListener('click', function() {
  console.log(this); // HTMLButtonElement (элемент, на котором сработало событие)
});
```

### 4. Конструктор (с оператором new)

```javascript
function User(name) {
  this.name = name;
}

const admin = new User('Иван');
console.log(admin.name); // "Иван"
```

## Проблемы контекста

### Потеря контекста

```javascript
const user = {
  name: 'Мария',
  greet() {
    console.log(`Привет, ${this.name}!`);
  }
};

const greetFunc = user.greet;
greetFunc(); // "Привет, undefined!" (контекст потерян)
```

## Способы управления контекстом

### 1. `bind()`

```javascript
const boundGreet = user.greet.bind(user);
boundGreet(); // "Привет, Мария!"
```

### 2. `call()` и `apply()`

```javascript
function introduce(age, city) {
  console.log(`${this.name}, ${age} лет, ${city}`);
}

introduce.call(user, 25, 'Москва');
introduce.apply(user, [25, 'Москва']);
```

### 3. Стрелочные функции (ES6)

```javascript
const user = {
  name: 'Пётр',
  greet: () => {
    console.log(`Привет, ${this.name}!`); // Не работает как ожидается!
  }
};

user.greet(); // "Привет, undefined!" (стрелочные функции не имеют своего this)
```

## Практические рекомендации

1. Для методов объектов используйте обычные функции
2. Для callback-функций используйте стрелочные функции или `bind()`
3. Всегда проверяйте контекст при передаче методов как callback'ов
4. В сложных случаях явно указывайте контекст с помощью `bind/call/apply`

> Контекст `this` — мощный инструмент JavaScript, но требует четкого понимания принципов его работы.

----

## Домашнее задание

### Уровень 1
**1. Базовый контекст метода**

Создайте объект `person` с свойствами:
* `name`: "Иван"
* `age`: 30
* методом `introduce()`, который выводит в консоль:  
"Меня зовут [name], мне [age] лет" (используя `this`)

Вызовите метод и проверьте результат.

**2. Потеря контекста**

Возьмите объект из задания 1. Создайте переменную `introFunc`, присвоив ей метод `introduce`.  
Вызовите `introFunc()`. Объясните результат.

----

### Уровень 2
**3. Фиксирование контекста**

Исправьте задание 2, используя:
* `bind()`
* Стрелочную функцию при создании метода

Сравните результаты.

**4. Контекст в обработчиках событий**

Создайте кнопку в HTML. Напишите обработчик клика, который:
* Как обычная функция - выводит `this` и `event.target`
* Как стрелочная функция - выводит `this` и `event.target`

Объясните разницу.

----

### Уровень 3
**5. Методы call/apply**

Создайте функцию `showInfo()`, которая выводит:  
"Компания: [company], Позиция: [position]" (используя `this`)

Вызовите ее с разными контекстами, используя:
* `call()` с объектом `{company: "Google", position: "Developer"}`
* `apply()` с объектом `{company: "Apple", position: "Designer"}`

**6. Контекст в конструкторах**

Создайте функцию-конструктор `Car(brand, model)`:
* При вызове с `new` создает объект с `brand` и `model`
* Добавьте метод `showCar()`, выводящий информацию о машине

Создайте экземпляр и вызовите метод.

----

### Уровень 4
**7. Цепочка контекстов**

Создайте объект `calculator` с:
* свойством `value` (начальное значение 0)
* методами `add`, `subtract`, `multiply` (каждый принимает число)
* методом `getValue`

Реализуйте возможность цепочки вызовов:  
`calculator.add(5).multiply(2).getValue()` → 10

**8. Контекст в классах**

Создайте класс `User` с:
* конструктором (принимает `name`, `age`)
* методом `greet()` (выводит приветствие)
* статическим методом `compare(user1, user2)` (сравнивает возраст)

Продемонстрируйте работу методов, включая статический.

----

### Уровень 5
**9. Собственная реализация bind**

Напишите функцию `myBind(fn, context)`, которая работает аналогично стандартному `bind()`, но без его использования.

**10. Контекст в асинхронном коде**

Создайте объект с:
* свойством `data`: "Важные данные"
* методом `getData()` (возвращает `this.data` через `setTimeout`)

Покажите:
* Как теряется контекст
* Как сохранить контекст (3 способа)

----

### Бонусное задание
**11. Анализ контекста**

Создайте функцию `analyzeContext()`, которая:
* Принимает функцию и массив аргументов
* Вызывает функцию с разными контекстами (`null`, `undefined`, `window`, `{}`)
* Выводит значение `this` в каждом случае
* Возвращает объект с результатами анализа
